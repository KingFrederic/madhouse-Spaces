import React, { useRef } from "react";
import { motion, useScroll, useTransform } from "framer-motion";
import { Mail, Phone, Clock } from "lucide-react";

// =============================================
// MadHouse Space Rental – Luxury Scroll Website
// Fixes:
// - Safe handling for empty image URLs (no more `url()` issues)
// - Completed DATA array (all 9 spaces)
// - Added smoke tests (won't alter runtime UI)
// =============================================

const ORANGE = "#ff6a00";

const IMAGES = {
  hero: "https://drive.google.com/uc?export=view&id=1LdcqZ2j_j_MkVnULO-YaO7bd2nUx49rT",
  booking: "", // optional background; falls back to gradient when empty
  gallery: "https://drive.google.com/uc?export=view&id=1yKskQqzaYiT9tGx5c3nbgAiHh4bbzT78",
  photoStudio: "https://drive.google.com/uc?export=view&id=1Qk3Lc9GU82NX0D806bwrTXxrzfRa5Krl",
  meetingRoom: "https://drive.google.com/uc?export=view&id=1X6-uWm9KWK3WsbR0b2EZmn_e6QqmuWL5",
  amphitheatre: "https://drive.google.com/uc?export=view&id=1tfzl2Ico04mcbIc56foSnZoZiPR-h7qX",
  artStudio: "https://drive.google.com/uc?export=view&id=1EOtUoMErCFcJ7J0GFFWwuWvFsQlFK6Zg",
  gameRoom: "https://drive.google.com/uc?export=view&id=162Ul5OyQmYbUbAr07hVMqi0SDzV5vjAx",
  makersStudio: "https://drive.google.com/uc?export=view&id=1HK-oWdfYjkUAfRBcuv2L8glTgttWArTw",
  terrace: "https://drive.google.com/uc?export=view&id=1p-IMurIfS0r-IuZY8vKc3PaOSjGp0RgA",
  greenRoom: "https://drive.google.com/uc?export=view&id=12WWRtB8M6D1OSu--wEeoixJdentCI00F",
  closing: "", // empty is OK now; we use a gradient fallback automatically
} as const;

const CONTACT = {
  email: "spaces@tikeraafrica.org",
  phone: "+234 810 557 0023",
  hours: "9 AM – 6 PM",
} as const;

// Helper: only apply backgroundImage when we actually have a URL
const getBgStyle = (image?: string): React.CSSProperties =>
  image && image.trim() !== "" ? ({ backgroundImage: `url(${image})` }) : ({});

function ParallaxSection({
  id,
  image,
  children,
  darkOverlay = true,
}: {
  id: string;
  image?: string;
  children: React.ReactNode;
  darkOverlay?: boolean;
}) {
  const ref = useRef<HTMLDivElement | null>(null);
  const { scrollYProgress } = useScroll({ target: ref, offset: ["start end", "end start"] });
  const y = useTransform(scrollYProgress, [0, 1], ["-10%", "10%"]);
  const hasImage = Boolean(image && image.trim() !== "");

  return (
    <section id={id} ref={ref} className="relative min-h-screen w-full overflow-hidden bg-black text-white">
      {/* Background */}
      {hasImage ? (
        <motion.div
          style={{ y, ...getBgStyle(image) }}
          className="absolute inset-0 bg-cover bg-center will-change-transform"
        />
      ) : (
        <motion.div
          style={{ y }}
          className="absolute inset-0 will-change-transform bg-gradient-to-b from-zinc-900 to-black"
        />
      )}

      {/* Overlay */}
      <div
        className={`absolute inset-0 ${darkOverlay ? "bg-black/65" : "bg-black/40"}`}
        style={{
          background: darkOverlay
            ? "linear-gradient(180deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.65) 40%, rgba(0,0,0,0.6) 100%)"
            : undefined,
        }}
      />

      {/* Content */}
      <div className="relative z-10 mx-auto flex min-h-screen max-w-7xl flex-col items-center justify-center px-6 py-20">
        {children}
      </div>
    </section>
  );
}

function GlowCard({ title, items, note, compact = false }: { title?: string; items?: string[]; note?: string; compact?: boolean; }) {
  return (
    <div
      className="group rounded-2xl border border-white/10 bg-white/5 p-6 backdrop-blur-sm transition-all duration-300 hover:border-[var(--orange)]/60 hover:shadow-[0_0_24px_rgba(255,106,0,0.35)]"
      // @ts-ignore – allow CSS var inline
      style={{ ['--orange']: ORANGE }}
    >
      {title && <h4 className="mb-4 text-lg font-semibold tracking-wide text-white">{title}</h4>}
      {Array.isArray(items) && (
        <ul className={`space-y-2 text-sm text-white/80 ${compact ? "leading-relaxed" : "leading-7"}`}>
          {items.map((it, i) => (
            <li key={i} className="pl-4">• {it}</li>
          ))}
        </ul>
      )}
      {note && <p className="mt-3 text-xs text-white/60">{note}</p>}
    </div>
  );
}

function RatePill({ children }: { children: React.ReactNode; }) {
  return (
    <div
      className="inline-flex items-center gap-2 rounded-full border border-white/15 bg-white/5 px-4 py-2 text-sm text-white/90 shadow-[0_0_0_rgba(0,0,0,0)] transition-all hover:border-[var(--orange)]/60 hover:shadow-[0_0_24px_rgba(255,106,0,0.35)]"
      // @ts-ignore – allow CSS var inline
      style={{ ['--orange']: ORANGE }}
    >
      <span className="h-2 w-2 rounded-full" style={{ backgroundColor: ORANGE }} />
      <span>{children}</span>
    </div>
  );
}

function SectionHeader({ kicker, title, subtitle }: { kicker?: string; title: string; subtitle?: string; }) {
  return (
    <div className="mb-8 text-center">
      {kicker && (
        <div className="mb-3 text-xs uppercase tracking-[0.25em] text-white/60">{kicker}</div>
      )}
      <h2 className="mb-3 text-4xl font-bold tracking-tight text-white md:text-5xl">{title}</h2>
      {subtitle && <p className="mx-auto max-w-3xl text-white/70">{subtitle}</p>}
    </div>
  );
}

function TwoCol({ left, right }: { left: React.ReactNode; right: React.ReactNode; }) {
  return (
    <div className="grid w-full grid-cols-1 gap-6 md:grid-cols-2">
      <div>{left}</div>
      <div>{right}</div>
    </div>
  );
}

function Hero() {
  return (
    <ParallaxSection id="hero" image={IMAGES.hero}>
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.7 }}
        className="text-center"
      >
        <div className="mx-auto mb-6 inline-flex items-center gap-3 rounded-full border border-white/10 bg-white/5 px-4 py-2 text-white/80">
          <Clock className="h-4 w-4" />
          <span>Opening Hours: {CONTACT.hours}</span>
        </div>
        <h1 className="mx-auto max-w-5xl text-5xl font-extrabold leading-tight text-white md:text-6xl">
          MadHouse Space Rental
        </h1>
        <p className="mx-auto mt-4 max-w-2xl text-white/75">
          Spaces for art, ideas, and bold gatherings.
        </p>
        <div className="mt-10 flex items-center justify-center gap-4">
          <a
            href="#booking"
            className="rounded-xl border border-white/10 bg-white/10 px-6 py-3 text-sm font-medium text-white backdrop-blur-sm transition-all hover:border-[var(--orange)]/60 hover:text-white hover:shadow-[0_0_24px_rgba(255,106,0,0.35)]"
            // @ts-ignore – allow CSS var inline
            style={{ ['--orange']: ORANGE }}
          >
            Booking Policy
          </a>
          <a
            href="#contact"
            className="rounded-xl border border-white/10 bg-[var(--orange)] px-6 py-3 text-sm font-semibold text-black transition-all hover:shadow-[0_0_24px_rgba(255,106,0,0.45)]"
            // @ts-ignore – allow CSS var inline
            style={{ ['--orange']: ORANGE }}
          >
            Contact
          </a>
        </div>
      </motion.div>
    </ParallaxSection>
  );
}

function Booking() {
  return (
    <ParallaxSection id="booking" image={IMAGES.booking}>
      <SectionHeader kicker="Policy" title="Booking Policy & Information" />
      <div className="mx-auto max-w-4xl space-y-4 text-white/85">
        <GlowCard
          items={[
            "A deposit of 50% is required to secure your booking; the balance is due 5 days before the event.",
            "All prices are fixed and exclusive of VAT.",
            "Weekend events attract a 20% surcharge on the full rental value of the space being used.",
            "A 30% charge during holidays.",
            "A 20% caution fee will be added to the space rental.",
            `To book any of our spaces, email or call us.`,
          ]}
        />
      </div>
    </ParallaxSection>
  );
}

function SpaceSection({ id, title, image, uses, features, rates, note }: { id: string; title: string; image?: string; uses: string[]; features: string[]; rates: string[]; note?: string; }) {
  return (
    <ParallaxSection id={id} image={image}>
      <SectionHeader kicker="Space" title={title} />
      <TwoCol
        left={<GlowCard title="Uses" items={uses} compact />}
        right={
          <div className="space-y-6">
            <GlowCard title="Key Features" items={features} compact note={note} />
            <div className="flex flex-wrap gap-3">
              {rates.map((r, i) => (
                <RatePill key={i}>{r}</RatePill>
              ))}
            </div>
          </div>
        }
      />
    </ParallaxSection>
  );
}

function ClosingQuote() {
  return (
    <ParallaxSection id="closing" image={IMAGES.closing}>
      <motion.blockquote
        initial={{ opacity: 0, y: 20 }}
        whileInView={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.6 }}
        className="mx-auto max-w-4xl text-center text-2xl font-semibold text-white md:text-3xl"
      >
        “Every great story starts with the right setting, and we have the perfect one for yours.”
      </motion.blockquote>
    </ParallaxSection>
  );
}

function Contact() {
  return (
    <ParallaxSection id="contact" image={IMAGES.hero} darkOverlay={false}>
      <SectionHeader kicker="Get in touch" title="Contact" />
      <div className="mx-auto max-w-xl space-y-4 text-white/90">
        <a
          href={`mailto:${CONTACT.email}`}
          className="group flex items-center gap-3 rounded-xl border border-white/10 bg-white/5 px-5 py-4 transition-all hover:border-[var(--orange)]/60 hover:shadow-[0_0_24px_rgba(255,106,0,0.35)]"
          // @ts-ignore – allow CSS var inline
          style={{ ['--orange']: ORANGE }}
        >
          <Mail className="h-5 w-5 text-white/80 transition-colors group-hover:text-white" />
          <span>{CONTACT.email}</span>
        </a>
        <a
          href={`tel:${CONTACT.phone.replace(/\s/g, "")}`}
          className="group flex items-center gap-3 rounded-xl border border-white/10 bg-white/5 px-5 py-4 transition-all hover:border-[var(--orange)]/60 hover:shadow-[0_0_24px_rgba(255,106,0,0.35)]"
          // @ts-ignore – allow CSS var inline
          style={{ ['--orange']: ORANGE }}
        >
          <Phone className="h-5 w-5 text-white/80 transition-colors group-hover:text-white" />
          <span>{CONTACT.phone}</span>
        </a>
        <div className="flex items-center gap-3 text-white/70">
          <Clock className="h-5 w-5" />
          <span>Opening Hours: {CONTACT.hours}</span>
        </div>
      </div>
    </ParallaxSection>
  );
}

const DATA = [
  {
    id: "gallery",
    title: "Gallery",
    image: IMAGES.gallery,
    uses: ["Art exhibitions", "Pop-up shows", "Brand showcases", "Installations"],
    features: [
      "Capacity: Up to 100 people (conference seating)",
      "Natural light, mood lighting",
      "Sound system",
      "Fully air-conditioned",
      "Interactive display screens",
    ],
    rates: ["₦1,000,000 per day (events other than exhibitions)"],
  },
  {
    id: "photography-studio",
    title: "Photography Studio",
    image: IMAGES.photoStudio,
    uses: ["Photography sessions", "Video shoots", "Product shoots", "Content creation"],
    features: [
      "Spacious studio",
      "2 strobe lights",
      "Access to 1 backdrop",
      "1 AD100 Pro light",
      "Changing area",
    ],
    rates: [
      "Video (Regular): Weekdays ₦30,000/hr, Weekends ₦35,000/hr",
      "Video (Student): Weekdays ₦15,000/hr, Weekends ₦20,000/hr",
      "Photo (Regular): Weekdays ₦15,000/hr, Weekends ₦20,000/hr",
      "Photo (Student): Weekdays ₦10,000/hr, Weekends ₦15,000/hr",
    ],
    note: "In-house professional photographers are available on request.",
  },
  {
    id: "meeting-room",
    title: "Meeting Room",
    image: IMAGES.meetingRoom,
    uses: ["Meetings", "Presentations", "Team strategy sessions", "Interviews", "Workshops"],
    features: [
      "Capacity: Up to 30 people",
      "Seating: 20 chairs with writing pads",
      "TV screen, whiteboard",
      "Internet-enabled panel, flip chart stand",
      "Access to Terrace 1, lagoon view",
    ],
    rates: ["Weekdays: ₦350,000 per day"],
  },
  {
    id: "amphitheatre",
    title: "Amphitheatre",
    image: IMAGES.amphitheatre,
    uses: ["Performances", "Screenings", "Lectures", "Community events", "Panels"],
    features: [
      "Capacity: 100-seater",
      "Sound system",
      "Pod screens",
      "Audiovisual equipment",
      "Accessible seating",
    ],
    rates: ["₦600,000 per day", "₦100,000 per hour (minimum 2 hours)"],
  },
  {
    id: "art-studio",
    title: "Art Studio",
    image: IMAGES.artStudio,
    uses: ["Art classes", "Workshops", "Portfolio creation", "Group creative sessions"],
    features: ["Adjustable easels", "Natural lighting", "Workstations", "Outdoor space"],
    rates: ["Weekly: ₦60,000", "Monthly: ₦200,000"],
  },
  {
    id: "game-room",
    title: "Game Room",
    image: IMAGES.gameRoom,
    uses: ["Casual hangouts", "Team bonding", "Social events"],
    features: [
      "Capacity: Up to 20 people",
      "Access to Terrace 1",
      "Board games, card games",
      "Comfortable seating",
      "Interactive screens, meeting space",
    ],
    rates: ["Weekdays: ₦550,000 per day"],
  },
  {
    id: "makers-studio",
    title: "Makers Studio",
    image: IMAGES.makersStudio,
    uses: ["Prototyping", "DIY projects", "Product design", "Creative making"],
    features: [
      "Capacity: Up to 50 people",
      "TV screen, whiteboard",
      "Internet-enabled panel",
      "Flip chart stand",
      "Lagoon view",
    ],
    rates: ["Weekdays: ₦450,000 per day"],
  },
  {
    id: "terrace",
    title: "Terrace",
    image: IMAGES.terrace,
    uses: ["Outdoor events", "Cocktail parties", "Networking events", "Small concerts", "Open-air workshops"],
    features: [
      "Open-air layout",
      "Ambient lighting",
      "Lagoon view",
      "Flexible seating",
      "Cooling fans",
    ],
    rates: ["Terrace 1 (1st floor): ₦100,000 per day", "Terrace 2 (2nd floor): ₦150,000 per day"],
  },
  {
    id: "green-room",
    title: "Green Room",
    image: IMAGES.greenRoom,
    uses: ["VIP holding area", "Interviews", "Private makeup/dressing", "Talent waiting area"],
    features: ["Capacity: Up to 20 people", "TV Screen or interactive screen panel"],
    rates: ["Weekdays: ₦250,000 per day"],
  },
] as const;

// =============================
// Smoke Tests (console only)
// =============================
function runSmokeTests() {
  try {
    const expect = (cond: boolean, msg: string) => { if (!cond) console.error(`SMOKE TEST: ${msg}`); };

    // DATA structure
    expect(Array.isArray(DATA), "DATA should be an array");
    expect(DATA.length === 9, "DATA should contain 9 sections");

    // IMAGES keys
    const reqKeys = ["hero","gallery","photoStudio","meetingRoom","amphitheatre","artStudio","gameRoom","makersStudio","terrace","greenRoom","closing"];
    reqKeys.forEach(k => expect(Object.prototype.hasOwnProperty.call(IMAGES, k), `IMAGES missing key ${k}`));

    // Validate entries
    DATA.forEach((s, idx) => {
      expect(typeof s.id === "string" && s.id.length > 0, `#${idx} missing id`);
      expect(typeof s.title === "string" && s.title.length > 0, `#${idx} missing title`);
      expect(typeof s.image === "string", `#${idx} image should be a string (URL or empty)`);
      expect(Array.isArray(s.uses) && s.uses.length > 0, `#${idx} uses should be non-empty`);
      expect(Array.isArray(s.features) && s.features.length > 0, `#${idx} features should be non-empty`);
      expect(Array.isArray(s.rates) && s.rates.length > 0, `#${idx} rates should be non-empty`);
    });

    // Fallback image handling
    const styleEmpty = getBgStyle("");
    expect(!('backgroundImage' in styleEmpty), "getBgStyle('') should not set backgroundImage");

    const styleHero = getBgStyle(IMAGES.hero);
    expect('backgroundImage' in styleHero, "getBgStyle(hero) should set backgroundImage");

    console.info("SMOKE TEST: completed");
  } catch (e) {
    console.error("SMOKE TEST: exception", e);
  }
}
runSmokeTests();

function TopNav() {
  const links = [
    { id: "hero", label: "Home" },
    { id: "booking", label: "Booking" },
    ...DATA.map((s) => ({ id: s.id, label: s.title })),
    { id: "closing", label: "Quote" },
    { id: "contact", label: "Contact" },
  ];

  return (
    <div className="pointer-events-none fixed inset-x-0 top-0 z-40 mx-auto flex max-w-7xl items-center justify-between px-4 py-4">
      <div className="pointer-events-auto rounded-full border border-white/10 bg-black/60 px-4 py-2 text-sm font-semibold text-white/90 backdrop-blur-md">
        MADHOUSE
      </div>
      <nav className="pointer-events-auto hidden items-center gap-2 rounded-full border border-white/10 bg-black/60 p-1 backdrop-blur-md md:flex">
        {links.map((l) => (
          <a
            key={l.id}
            href={`#${l.id}`}
            className="rounded-full px-3 py-2 text-xs text-white/80 transition-all hover:text-white hover:shadow-[0_0_16px_rgba(255,106,0,0.35)]"
            // @ts-ignore – allow CSS var inline
            style={{ ['--orange']: ORANGE }}
          >
            {l.label}
          </a>
        ))}
      </nav>
    </div>
  );
}

export default function MadHouseSpaceRental() {
  return (
    <div className="scroll-smooth bg-black text-white">
      <TopNav />
      <Hero />
      <Booking />

      {DATA.map((s) => (
        <SpaceSection
          key={s.id}
          id={s.id}
          title={s.title}
          image={s.image}
          uses={s.uses}
          features={s.features}
          rates={s.rates}
          note={s.note}
        />
      ))}

      <ClosingQuote />
      <Contact />

      {/* Footer Bar */}
      <footer className="sticky bottom-0 z-50 w-full bg-gradient-to-t from-black/80 to-black/0 p-4">
        <div className="mx-auto flex max-w-7xl items-center justify-between rounded-2xl border border-white/10 bg-black/60 px-4 py-3 backdrop-blur">
          <span className="text-xs text-white/60">© {new Date().getFullYear()} MadHouse</span>
          <div className="flex items-center gap-2">
            <a
              href="#contact"
              className="rounded-xl border border-white/10 bg-[var(--orange)] px-4 py-2 text-xs font-semibold text-black transition-all hover:shadow-[0_0_24px_rgba(255,106,0,0.45)]"
              // @ts-ignore – allow CSS var inline
              style={{ ['--orange']: ORANGE }}
            >
              Book a Space
            </a>
          </div>
        </div>
      </footer>
    </div>
  );
}
